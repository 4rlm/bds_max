<h1 class="page-header">Geolocations</h1>
<h4 class="text-center">GeoLocated Account Locations</h4>
<h4 class="text-center">Used to find duplicates and see which stores are nearest.</h4>
<h5 class="text-center">Click any Address to View Map and List of Local Area.</h5>

<h4>Total GPS Accounts: <%= number_with_delimiter(@locations_count) %></h4>

<h4>Selected GPS Accounts: <%= number_with_delimiter(@selected_locations_count) %></h4>
<%= link_to "Geo Places Starter", geo_places_starter_btn_path, class: 'btn btn-warning' %>

<!-- FILTER PARTIAL -->
<%= render partial: 'filter' %>

<!-- ## FILTER - STARTS## -->

<!-- <td><%#= select_tag :sales_person, options_for_select(sfdc_sales_person_list), multiple: true, class: 'selectpicker form-control', title: "[]" %></td> -->


<!-- ## FILTER - ENDS## -->

<div class="pull-right">
    <%= link_to 'Add Record', new_location_path, class: 'btn btn-primary' %>
    <%= link_to 'Import CSV', location_import_page_path, class: 'btn btn-primary' %>
    <%= link_to 'Download CSV', locations_path(format: "csv"), class: 'btn btn-primary' %>
</div> <br>

<%= form_tag locations_path, :method => :get do %>
    <%= text_field_tag :search, params[:search] %>
    <%= submit_tag "Search Near", :name => nil %>
<% end %>

<%= form_tag "/locations", method: :get, class: 'form-inline'  do %>

    <!-- <table class="geo-result-table table table-bordered table-hover text-nowrap table-striped"> -->

    <% num = 0 %>
    <% @locations.each do |location| %>
        <% num +=1 %>
        <div class="row profile-row">
            <div class="profile-col col-md-12">

                <table class="geo-result-table table table-bordered table-hover table-striped">

                    <!-- TOP ROW -->
                    <thead>
                        <tr>
                            <th><%= check_box_tag 'check_all', 'check_all', false, onClick: 'checkAll(this);' %></th>
                            <th>Hierarchy</th>
                            <th>Type</th>
                            <th>Account</th>
                            <th>Address</th>
                            <th>Phone</th>
                            <th>URL</th>
                            <th>Root</th>
                            <th>Coordinates</th>
                        </tr>
                    </thead>

                    <tbody><!-- 2ND ROW: GEO DATA -->
                        <%= render partial: 'table_row', locals: {location: location, num: num} %>
                        <% s_ids = location.coord_id_arr %>
                        <% s_ids.each do |id| %>
                            <% if loc = Location.find_by(sfdc_id: id) %>
                                <%= render partial: 'table_row', locals: {location: loc, num: ""} %>
                            <% end %>
                        <% end %>
                    </tbody>
                </table>
            </div>
        </div>
    <% end %>


    <div class="pull-left">
        <div class="submit-button-area">
            <%= select_tag :selected_status, options_for_select(hierarchy_list), include_blank: '-- Update Status --', class: 'selectpicker' %>
        </div>
        <div class="submit-button-area">
            <%= submit_tag "Submit", class: 'btn btn-success' %>
        </div>
    </div>
<% end %>

<div class="pull-right">
    <%= link_to 'Add Record', new_location_path, class: 'btn btn-primary' %>
    <%= link_to 'Import CSV', location_import_page_path, class: 'btn btn-primary' %>
    <%= link_to 'Download CSV', locations_path(format: "csv"), class: 'btn btn-primary' %>
</div>

<%= will_paginate @locations, renderer: BootstrapPagination::Rails  %>
<br>
